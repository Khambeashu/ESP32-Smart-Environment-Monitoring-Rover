<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Rover Dashboard</title>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- MQTT.js -->
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      text-align: center;
    }
    h1 {
      margin-top: 10px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
      padding: 20px;
    }
    canvas {
      background: #020617;
      border-radius: 10px;
      padding: 10px;
    }
  </style>
</head>

<body>
  <h1>ðŸš€ Smart Environment Monitoring Rover</h1>

  <div class="grid">
    <div>
      <h3>ðŸŒ¡ Temperature (Â°C)</h3>
      <canvas id="tempChart"></canvas>
    </div>

    <div>
      <h3>ðŸ’§ Humidity (%)</h3>
      <canvas id="humChart"></canvas>
    </div>
  </div>

<script>
/* ---------- MQTT CONFIG ---------- */
const broker =
  'wss://1f5eef462dfd489c981b136920468901.s1.eu.hivemq.cloud:8884/mqtt';

const options = {
  username: 'Ashwini_Khambe',
  password: 'Khambe@123',
  keepalive: 60,
  clean: true
};

const client = mqtt.connect(broker, options);

/* ---------- CHART SETUP ---------- */
const tempCtx = document.getElementById('tempChart');
const humCtx  = document.getElementById('humChart');

/* Temperature Chart */
const tempChart = new Chart(tempCtx, {
  type: 'line',
  data: {
    labels: [],
    datasets: [{
      label: 'Temperature Â°C',
      data: [],
      borderColor: '#f87171',
      backgroundColor: 'rgba(248, 113, 113, 0.2)',
      borderWidth: 2,
      tension: 0.4
    }]
  },
  options: {
    scales: {
      y: { beginAtZero: true }
    }
  }
});

/* Humidity Chart */
const humChart = new Chart(humCtx, {
  type: 'line',
  data: {
    labels: [],
    datasets: [{
      label: 'Humidity %',
      data: [],
      borderColor: '#60a5fa',
      backgroundColor: 'rgba(96, 165, 250, 0.2)',
      borderWidth: 2,
      tension: 0.4
    }]
  },
  options: {
    scales: {
      y: { beginAtZero: true }
    }
  }
});

/* ---------- MQTT EVENTS ---------- */
client.on('connect', () => {
  console.log('âœ… Connected to HiveMQ');
  client.subscribe('rover/environment');
});

client.on('message', (topic, message) => {
  if (topic === 'rover/environment') {
    const data = JSON.parse(message.toString());
    const time = new Date().toLocaleTimeString();

    // Temperature
    tempChart.data.labels.push(time);
    tempChart.data.datasets[0].data.push(data.temperature);

    // Humidity
    humChart.data.labels.push(time);
    humChart.data.datasets[0].data.push(data.humidity);

    // Keep only last 20 points
    if (tempChart.data.labels.length > 20) {
      tempChart.data.labels.shift();
      tempChart.data.datasets[0].data.shift();
      humChart.data.labels.shift();
      humChart.data.datasets[0].data.shift();
    }

    tempChart.update();
    humChart.update();
  }
});
</script>

</body>
</html>
